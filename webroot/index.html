<!doctype html>
<html lang="en" class="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>XOvalium Project</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            primary: "#98c379",
                            surface: "#1e1e1e",
                            "surface-variant": "#2d2d2d",
                        },
                    },
                },
            };
        </script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            body {
                font-family: "Inter", sans-serif;
            }
            * {
                transition:
                    background-color 0.3s ease,
                    color 0.3s ease;
            }
            .nav-item.active {
                color: #98c379;
            }
            .nav-item.active svg {
                fill: rgba(152, 195, 121, 0.2);
            }
        </style>
    </head>
    <body
        class="bg-gray-100 dark:bg-[#121212] text-gray-900 dark:text-gray-100 min-h-screen pb-24"
    >
        <div
            class="relative w-full h-52 bg-gray-200 dark:bg-gray-800 overflow-hidden rounded-b-[2.5rem] shadow-2xl"
        >
            <img
                src="./banner.webp"
                alt="Module Banner"
                class="w-full h-full object-cover opacity-90 hover:opacity-100 transition-opacity duration-700"
            />
            <div
                class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black via-black/60 to-transparent p-6 pt-20"
            >
                <div class="flex items-center justify-between">
                    <div>
                        <h1
                            class="text-3xl font-black text-white tracking-tighter italic"
                        >
                            XOVALIUM
                        </h1>
                        <p
                            class="text-[10px] text-gray-400 font-bold uppercase tracking-widest -mt-1"
                        >
                            Testing for XOS Framework
                        </p>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <div
                            id="core-status"
                            class="bg-primary/20 backdrop-blur-xl border border-primary/30 px-4 py-1 rounded-full shadow-lg shadow-primary/10 transition-all duration-500"
                        >
                            <span
                                class="text-[9px] font-black text-primary uppercase tracking-[0.2em]"
                                id="core-text"
                                >Single Core</span
                            >
                        </div>
                        <span
                            id="active-tools-list"
                            class="text-[8px] text-gray-400 font-mono text-right hidden"
                            >Checking...</span
                        >
                    </div>
                </div>
            </div>
        </div>
        <main class="px-4 -mt-6 relative z-10">
            <div id="view-tweaks" class="view-section">
                <div
                    class="mt-8 bg-white dark:bg-[#1e1e1e] rounded-xl shadow-lg p-5 mb-4 border border-gray-100 dark:border-gray-800"
                >
                    <div class="flex items-center justify-between mb-3">
                        <h2
                            class="text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400"
                        >
                            Device Info
                        </h2>
                        <div
                            id="status-indicator"
                            class="w-2 h-2 rounded-full bg-red-500 animate-pulse"
                        ></div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400"
                                >Model</span
                            >
                            <span id="device-model" class="font-medium"
                                >Loading...</span
                            >
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400"
                                >Android Version</span
                            >
                            <span id="android-ver" class="font-medium"
                                >...</span
                            >
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600 dark:text-gray-400"
                                >Access mode</span
                            >
                            <span
                                id="root-status"
                                class="font-medium text-yellow-500"
                                >Checking...</span
                            >
                        </div>
                    </div>
                </div>

                <!-- Tweak Actions -->
                <h3
                    class="text-sm font-bold mb-3 px-1 uppercase tracking-widest text-gray-500"
                >
                    Quick Actions
                </h3>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button
                        onclick="runTweak('boost')"
                        class="bg-white dark:bg-[#1e1e1e] p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 active:scale-95 transition-all text-center"
                    >
                        <div
                            class="bg-blue-100 dark:bg-blue-900/30 w-12 h-12 rounded-2xl flex items-center justify-center mx-auto mb-2 text-blue-600 dark:text-blue-400"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-6 w-6"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"
                                />
                            </svg>
                        </div>
                        <span
                            class="text-xs font-black uppercase tracking-wider block"
                            >Boost Now</span
                        >
                    </button>

                    <button
                        onclick="runTweak('battery')"
                        class="bg-white dark:bg-[#1e1e1e] p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 active:scale-95 transition-all text-center"
                    >
                        <div
                            class="bg-orange-100 dark:bg-orange-900/30 w-12 h-12 rounded-2xl flex items-center justify-center mx-auto mb-2 text-orange-600 dark:text-orange-400"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-6 w-6"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707-.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                                />
                            </svg>
                        </div>
                        <span
                            class="text-xs font-black uppercase tracking-wider block"
                            >Optimizer</span
                        >
                    </button>
                    <button
                        onclick="runTweak('skia')"
                        class="col-span-2 bg-white dark:bg-[#1e1e1e] p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 active:scale-95 transition-all flex items-center justify-center gap-4"
                    >
                        <div
                            class="bg-indigo-100 dark:bg-indigo-900/30 w-10 h-10 rounded-xl flex items-center justify-center text-indigo-600 dark:text-indigo-400"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                class="h-6 w-6"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"
                                />
                            </svg>
                        </div>
                        <div class="text-left">
                            <span
                                class="text-xs font-black uppercase tracking-wider block"
                                >Enable Vulkan Mode</span
                            >
                            <span class="text-[10px] text-gray-500"
                                >Force SkiaVK Rendering</span
                            >
                        </div>
                    </button>
                </div>
            </div>
            <!-- Advanced View Removed -->

            <!-- VIEW: APP MANAGER -->
            <div id="view-apps" class="view-section hidden">
                <div class="mt-8 space-y-4">
                    <!-- App Selector -->
                    <div
                        class="bg-white dark:bg-[#1e1e1e] rounded-2xl shadow-lg p-5 border border-gray-100 dark:border-gray-800"
                    >
                        <h3
                            class="text-xs font-black uppercase tracking-widest text-gray-500 mb-4"
                        >
                            Target Application
                        </h3>
                        <div class="relative">
                            <input
                                type="text"
                                id="target-pkg"
                                placeholder="e.g. com.mobile.legends"
                                class="w-full bg-gray-50 dark:bg-[#2d2d2d] border border-gray-200 dark:border-gray-700 rounded-xl p-4 text-sm font-mono focus:ring-2 focus:ring-primary/50 outline-none transition-all pr-12"
                            />
                            <div class="absolute right-4 top-4 text-gray-400">
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-5 w-5"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                                    />
                                </svg>
                            </div>
                        </div>
                        <p class="text-[10px] text-gray-400 mt-2 italic px-1">
                            *Enter the package name of the app you want to
                            optimize.
                        </p>
                    </div>

                    <!-- Per-App Actions -->
                    <div class="grid grid-cols-1 gap-3">
                        <button
                            onclick="runAppTweak('performance')"
                            class="flex items-center gap-4 bg-white dark:bg-[#1e1e1e] p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 active:scale-[0.98] transition-all"
                        >
                            <div
                                class="bg-red-100 dark:bg-red-900/30 w-12 h-12 rounded-xl flex items-center justify-center text-red-600 dark:text-red-400 flex-shrink-0"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M13 10V3L4 14h7v7l9-11h-7z"
                                    />
                                </svg>
                            </div>
                            <div class="text-left">
                                <span
                                    class="text-sm font-black uppercase tracking-tight block"
                                    >Performance Mode</span
                                >
                                <span class="text-[10px] text-gray-500"
                                    >Unlocks CPU/GPU & BG Limit 3</span
                                >
                            </div>
                        </button>
                        <button
                            onclick="runAppTweak('uninstallDexopt')"
                            class="flex items-center gap-4 bg-white dark:bg-[#1e1e1e] p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 active:scale-[0.98] transition-all"
                        >
                            <div
                                class="bg-red-100 dark:bg-red-900/30 w-12 h-12 rounded-xl flex items-center justify-center text-red-600 dark:text-red-400 flex-shrink-0"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                                    />
                                </svg>
                            </div>
                            <div class="text-left">
                                <span
                                    class="text-sm font-black uppercase tracking-tight block"
                                    >Uninstall Dexopt</span
                                >
                                <span class="text-[10px] text-gray-500"
                                    >Uninstall dexopt compiler</span
                                >
                            </div>
                        </button>
                        <button
                            onclick="runAppTweak('dexopt')"
                            class="flex items-center gap-4 bg-white dark:bg-[#1e1e1e] p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 active:scale-[0.98] transition-all"
                        >
                            <div
                                class="bg-purple-100 dark:bg-purple-900/30 w-12 h-12 rounded-xl flex items-center justify-center text-purple-600 dark:text-purple-400 flex-shrink-0"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"
                                    />
                                </svg>
                            </div>
                            <div class="text-left">
                                <span
                                    class="text-sm font-black uppercase tracking-tight block"
                                    >Dex2Opt Speed</span
                                >
                                <span class="text-[10px] text-gray-500"
                                    >Compiles App Code (Recommended)</span
                                >
                            </div>
                        </button>

                        <button
                            onclick="runAppTweak('restrict')"
                            class="flex items-center gap-4 bg-white dark:bg-[#1e1e1e] p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 active:scale-[0.98] transition-all opacity-80"
                        >
                            <div
                                class="bg-gray-100 dark:bg-gray-900/30 w-12 h-12 rounded-xl flex items-center justify-center text-gray-600 dark:text-gray-400 flex-shrink-0"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-6 w-6"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
                                    />
                                </svg>
                            </div>
                            <div class="text-left">
                                <span
                                    class="text-sm font-black uppercase tracking-tight block"
                                    >Restrict App</span
                                >
                                <span class="text-[10px] text-gray-500"
                                    >Put to extreme deep sleep</span
                                >
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="view-section hidden">
                <div
                    class="mt-8 bg-white dark:bg-[#1e1e1e] rounded-xl shadow-lg p-5 border border-gray-100 dark:border-gray-800"
                >
                    <h2
                        class="text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-4"
                    >
                        General Settings
                    </h2>

                    <!-- Theme Toggle -->
                    <div
                        class="flex items-center justify-between py-2 border-b border-gray-100 dark:border-gray-800"
                    >
                        <div class="flex items-center gap-3">
                            <div
                                class="p-2 rounded-full bg-gray-100 dark:bg-gray-800"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-5 w-5"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                                    />
                                </svg>
                            </div>
                            <span class="font-medium">Dark Mode</span>
                        </div>
                        <label
                            class="relative inline-flex items-center cursor-pointer"
                        >
                            <input
                                type="checkbox"
                                id="theme-toggle"
                                class="sr-only peer"
                            />
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-500"
                            ></div>
                        </label>
                    </div>

                    <!-- About -->
                    <div class="flex items-center justify-between py-2 mt-2">
                        <div class="flex items-center gap-3">
                            <div
                                class="p-2 rounded-full bg-gray-100 dark:bg-gray-800"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-5 w-5"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                                    />
                                </svg>
                            </div>
                            <div>
                                <span class="font-medium block"
                                    >Version 1.0.0</span
                                >
                                <span class="text-xs text-gray-500"
                                    >XOvalium Project</span
                                >
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="bg-white dark:bg-[#1e1e1e] rounded-xl shadow-lg p-5 border border-gray-100 dark:border-gray-800 mt-4"
                >
                    <h2
                        class="text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-4"
                    >
                        Module
                    </h2>
                    <button
                        class="w-full text-left py-2 text-red-500 hover:text-red-400 transition-colors"
                    >
                        Uninstall Module
                    </button>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation Bar -->
        <nav
            class="fixed bottom-0 left-0 w-full bg-white dark:bg-[#1e1e1e] border-t border-gray-200 dark:border-gray-800 flex justify-around items-center h-16 z-50 pb-safe"
        >
            <button
                onclick="switchTab('tweaks')"
                id="nav-tweaks"
                class="nav-item active flex flex-col items-center justify-center w-full h-full text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 mb-1 transition-colors"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                    />
                </svg>
                <span class="text-[10px] font-medium uppercase tracking-tighter"
                    >Home</span
                >
            </button>

            <button
                onclick="switchTab('apps')"
                id="nav-apps"
                class="nav-item flex flex-col items-center justify-center w-full h-full text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 mb-1 transition-colors"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
                    />
                </svg>
                <span class="text-[10px] font-medium uppercase tracking-tighter"
                    >Apps</span
                >
            </button>

            <button
                onclick="switchTab('settings')"
                id="nav-settings"
                class="nav-item flex flex-col items-center justify-center w-full h-full text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6 mb-1 transition-colors"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                    />
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                </svg>
                <span class="text-[10px] font-medium uppercase tracking-tighter"
                    >Settings</span
                >
            </button>
        </nav>

        <script type="module">
            import {
                exec,
                toast,
            } from "https://cdn.jsdelivr.net/npm/kernelsu@1.0.6/+esm";

            const $ = (id) => document.getElementById(id);
            const log = (msg) => {
                const el = $("console-log");
                if (el) {
                    el.innerHTML += `> ${msg}<br>`;
                    el.scrollTop = el.scrollHeight;
                }
            };

            // Tab Switching Logic
            window.switchTab = (tabName) => {
                // Hide all sections
                ["tweaks", "apps", "settings"].forEach((t) => {
                    const section = $(`view-${t}`);
                    const btn = $(`nav-${t}`);
                    if (section) section.classList.add("hidden");
                    if (btn) btn.classList.remove("active");
                });

                // Show selected
                const activeSection = $(`view-${tabName}`);
                const activeBtn = $(`nav-${tabName}`);

                if (activeSection) activeSection.classList.remove("hidden");
                if (activeBtn) activeBtn.classList.add("active");
            };

            // Theme Logic
            const themeToggle = $("theme-toggle");
            function initTheme() {
                if (
                    localStorage.theme === "dark" ||
                    (!("theme" in localStorage) &&
                        window.matchMedia("(prefers-color-scheme: dark)")
                            .matches)
                ) {
                    document.documentElement.classList.add("dark");
                    if (themeToggle) themeToggle.checked = true;
                } else {
                    document.documentElement.classList.remove("dark");
                    if (themeToggle) themeToggle.checked = false;
                }
            }
            if (themeToggle) {
                themeToggle.addEventListener("change", function () {
                    if (this.checked) {
                        document.documentElement.classList.add("dark");
                        localStorage.theme = "dark";
                    } else {
                        document.documentElement.classList.remove("dark");
                        localStorage.theme = "light";
                    }
                });
            }

            // Device Info Logic
            async function fetchDeviceInfo() {
                try {
                    const model = await exec("getprop ro.product.model");
                    if ($("device-model"))
                        $("device-model").textContent =
                            model.stdout.trim() || "Unknown";

                    const android = await exec(
                        "getprop ro.build.version.release",
                    );
                    if ($("android-ver"))
                        $("android-ver").textContent =
                            android.stdout.trim() || "Unknown";

                    const id = await exec("id -u");
                    if (id.stdout.trim() === "0") {
                        if ($("root-status")) {
                            $("root-status").textContent = "Granted";
                            $("root-status").className =
                                "font-medium text-green-500";
                        }
                        if ($("status-indicator"))
                            $("status-indicator").className =
                                "w-2 h-2 rounded-full bg-green-500";
                    } else {
                        if ($("root-status")) {
                            $("root-status").textContent = "AxManager";
                            $("root-status").className =
                                "font-medium text-white";
                        }
                        if ($("status-indicator"))
                            $("status-indicator").className =
                                "w-2 h-2 rounded-full bg-gray-400";
                    }
                } catch (e) {
                    log("Error fetching info: " + e);
                    if ($("root-status"))
                        $("root-status").textContent = "No Bridge";
                }
            }

            window.runTweak = async (type) => {
                try {
                    toast(`Applying ${type} tweak...`);
                    log(`Executing action: ${type}`);

                    let cmd = "";
                    switch (type) {
                        case "anim":
                            const val = $("anim-scale").value;
                            cmd = `settings put global window_animation_scale ${val} && settings put global transition_animation_scale ${val} && settings put global animator_duration_scale ${val}`;
                            break;
                        case "hz":
                            cmd = `settings put global peak_refresh_rate 120.0 && settings put global min_refresh_rate 120.0`;
                            break;
                        case "game":
                            cmd = `cmd game mode set performance`;
                            break;
                        case "power":
                            cmd = `cmd power set-mode 0`; // 0 is usually performance on some devices
                            break;
                        case "compaction":
                            cmd = `cmd activity compact-all`;
                            break;
                        case "boost":
                            // Combine boost with debloat for maximum RAM recovery
                            cmd = `pm trim-caches 999G && am kill-all && sh /data/adb/modules/xovalium/tools/debloat.sh`;
                            break;
                        case "battery":
                            cmd = `sh /data/adb/modules/xovalium/tools/gugugaga.sh`;
                            break;
                        case "skia":
                            cmd = `
                                TOOL="skia.sh"
                                AX_PATH="/data/data/com.android.shell/AxManager/plugins/xovalium/tools/$TOOL"
                                MOD_PATH="/data/adb/modules/xovalium/tools/$TOOL"
                                if [ -f "$AX_PATH" ]; then sh "$AX_PATH"; else sh "$MOD_PATH"; fi
                            `;
                            break;
                        default:
                            log(`Unknown tweak type: ${type}`);
                            return;
                    }

                    if (cmd) {
                        const res = await exec(cmd);
                        if (res.stdout) log(`> ${res.stdout}`);
                        if (res.stderr) log(`> ERR: ${res.stderr}`);
                        toast(`${type} applied!`);
                    }
                } catch (e) {
                    log("Error: " + e);
                    toast("Failed to run tweak");
                }
            };

            window.runAppTweak = async (action) => {
                const pkg = $("target-pkg").value.trim();
                if (!pkg) return toast("Enter package name first!");

                try {
                    toast(`Optimizing ${pkg}...`);
                    log(`App Action: ${action} -> ${pkg}`);

                    let cmd = "";
                    switch (action) {
                        case "performance":
                            cmd = `sh /data/data/com.android.shell/AxManager/plugins/xovalium/tools/performance.sh ${pkg}`;
                            break;
                        case "dexopt":
                            cmd = `sh /data/data/com.android.shell/AxManager/plugins/xovalium/tools/dex2opt.sh ${pkg}`;
                            break;
                        case "uninstallDexopt":
                            cmd = `cmd package compile --reset ${pkg}`;
                            break;
                        case "restrict":
                            cmd = `pm set-app-standby ${pkg} restricted && am force-stop ${pkg}`;
                            break;
                    }

                    if (cmd) {
                        const res = await exec(cmd);
                        if (res.stdout) log(`> ${res.stdout}`);
                        if (res.stderr) log(`> ERR: ${res.stderr}`);
                        toast(`${action} finished!`);
                    }
                } catch (e) {
                    log(`Error: ${e}`);
                    toast("Action failed");
                }
            };

            window.runCustomTweak = async () => {
                const cmd = $("custom-cmd").value;
                if (!cmd) return toast("Please enter a command");

                try {
                    toast("Executing custom command...");
                    log(`Custom Exec: ${cmd}`);

                    // Real execution
                    const res = await exec(cmd);

                    if (res.stdout) log(`> ${res.stdout}`);
                    if (res.stderr) log(`> ERR: ${res.stderr}`);

                    toast("Execution finished");
                } catch (e) {
                    log(`Error: ${e}`);
                    toast("Execution failed");
                }
            };

            // Core Detection Logic
            async function updateCoreStatus() {
                try {
                    let tools = [];

                    // Check Gugugaga Monitor
                    const res = await exec("pgrep -f gugugaga.sh");
                    if (res.stdout.trim()) tools.push("Monitor");

                    // Check SkiaVK
                    const skia = await exec("getprop debug.hwui.renderer");
                    if (skia.stdout.trim() === "skiavk") tools.push("SkiaVK");

                    // Check RAM Opt (via background process limit)
                    const bg = await exec(
                        "settings get global background_process_limit",
                    );
                    const bgLimit = bg.stdout.trim();
                    if (bgLimit === "3" || bgLimit === "4")
                        tools.push("RamOpt");

                    const coreText = $("core-text");
                    const coreStatus = $("core-status");
                    const toolsList = $("active-tools-list");

                    if (tools.length > 0) {
                        coreText.textContent = "Hybrid Core";
                        coreStatus.className =
                            "bg-orange-500/20 backdrop-blur-md border border-orange-500/30 px-3 py-1 rounded-full";
                        coreText.className =
                            "text-[10px] font-black text-orange-500 uppercase tracking-widest";

                        if (toolsList) {
                            toolsList.textContent = tools.join(" + ");
                            toolsList.classList.remove("hidden");
                        }
                    } else {
                        coreText.textContent = "Single Core";
                        coreStatus.className =
                            "bg-primary/20 backdrop-blur-md border border-primary/30 px-3 py-1 rounded-full";
                        coreText.className =
                            "text-[10px] font-black text-primary uppercase tracking-widest";

                        if (toolsList) toolsList.classList.add("hidden");
                    }
                } catch (e) {
                    if ($("core-text"))
                        $("core-text").textContent = "Single Core";
                }
            }

            // Init
            initTheme();
            fetchDeviceInfo();
            updateCoreStatus();
            setInterval(updateCoreStatus, 5000); // Check every 5s
        </script>
    </body>
</html>
